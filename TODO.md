# devilwm 待办事项

本清单聚焦于：将当前协议 MVP 推进到“可日常使用”的最小必要功能集，
目标协议为 river 的 `river-window-management-v1`。

## P0 - 正确性与稳定性

- [x] 实现明确的 manage/render 阶段状态机约束。
  - 所有窗口管理状态请求仅在 `manage_start` 阶段发送。
  - 所有渲染状态请求仅在 `render_start` 阶段发送。
- [x] 完善协议对象生命周期与移除事件清理。
  - 窗口、输出、seat 及对应 node 对象都要可靠回收。
- [x] 增加面向协议时序的集成测试，避免回归。
  - 启动、首窗口映射、窗口关闭、输出热插拔、seat 移除。
- [x] 完善日志级别与默认输出策略。
  - 默认安静模式，调试日志按需开启。

## P1 - 核心窗口管理能力

- [x] 支持多输出布局分配。
  - 维护按输出划分的窗口集合。
  - 不再将所有窗口固定分配到第一个输出。
- [x] 支持可配置平铺布局。
  - 至少包含：monocle、主从（master/stack）、纵向栈。
- [x] 改进焦点模型。
  - 映射/取消映射后的焦点行为可预测。
  - “交互即焦点”策略支持配置。
- [x] 完整支持全屏流程。
  - 处理 `fullscreen_requested` 与 `exit_fullscreen_requested`。
  - 维护按输出的全屏层级规则。
- [x] 支持对话框/临时窗口浮动。
  - 使用 `parent` 提示与交互式 move/resize 事件。

## P1 - 输入与交互

- [x] 基于 `river_seat_v1` 绑定对象实现键盘/鼠标绑定。
  - 必需动作：启动应用、关闭窗口、焦点切换、交换窗口、切换布局。
- [x] 使用 seat operation 实现交互式移动/缩放。
  - 处理 `pointer_move_requested`、`pointer_resize_requested`。
- [x] 增加多显示器场景下的指针/焦点辅助行为。

## P2 - 使用体验与运维

- [x] 外部配置文件支持。
  - 默认配置 + 用户覆盖（布局、间距、边框、快捷键）。
- [x] 基础窗口规则系统。
  - 按 app-id/title 匹配并应用策略（浮动、输出、全屏等）。
- [x] 边框与视觉状态策略。
  - 通过 `set_borders` 管理焦点/非焦点样式。
- [x] 运行时命令接口。
  - 提供最小 `devilctl`（布局/焦点/工作区动作）。

## P2 - 开发体验

- [ ] 提供可复现的 nested 测试场景。
  - 单窗口烟雾测试与多窗口布局检查。
- [ ] 增加 CI。
  - 构建、静态检查、协议烟雾测试。
- [ ] 增加协议兼容性说明。
  - 明确支持的协议版本与未实现事件/请求。
